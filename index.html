<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Paradox Simulators</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #f59e0b;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #e2e8f0;
            --muted: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 3rem 2rem;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        nav {
            background: var(--card);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
        }

        nav a {
            color: var(--text);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            background: var(--bg);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        nav a:hover {
            background: var(--primary);
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        section {
            margin-bottom: 3rem;
        }

        .category-title {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent);
        }

        .paradox-card {
            background: var(--card);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .paradox-card h3 {
            color: var(--primary);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .paradox-card .points {
            background: var(--accent);
            color: var(--bg);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }

        .paradox-card .description {
            color: var(--muted);
            margin-bottom: 1rem;
        }

        .simulator {
            background: var(--bg);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .simulator h4 {
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .control-group label {
            font-size: 0.875rem;
            color: var(--muted);
        }

        input[type="range"] {
            width: 150px;
            accent-color: var(--primary);
        }

        input[type="number"] {
            width: 100px;
            padding: 0.5rem;
            border: 1px solid var(--muted);
            border-radius: 0.25rem;
            background: var(--card);
            color: var(--text);
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        button:hover {
            background: var(--secondary);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid var(--primary);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .visualization {
            margin-top: 1rem;
            min-height: 150px;
            position: relative;
        }

        canvas {
            width: 100%;
            border-radius: 0.5rem;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
            height: 200px;
            padding: 1rem;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .bar {
            width: 100%;
            background: var(--primary);
            border-radius: 0.25rem 0.25rem 0 0;
            transition: height 0.5s ease;
            min-height: 5px;
        }

        .bar.second {
            background: var(--secondary);
        }

        .bar-label {
            font-size: 0.75rem;
            color: var(--muted);
            margin-top: 0.5rem;
            text-align: center;
        }

        .insight {
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid var(--accent);
            padding: 1rem;
            margin-top: 1rem;
            font-style: italic;
        }

        /* Network visualization styles */
        .network-container {
            position: relative;
            height: 300px;
            border: 1px solid var(--muted);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .node {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .edge {
            position: absolute;
            background: var(--muted);
            height: 2px;
            transform-origin: left center;
            pointer-events: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-box {
            background: var(--card);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--muted);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.75rem;
            }

            nav {
                padding: 0.5rem;
            }

            nav a {
                font-size: 0.75rem;
                padding: 0.375rem 0.75rem;
            }

            main {
                padding: 1rem;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Interactive Paradox Simulators</h1>
        <p>Explore mind-bending paradoxes through interactive simulations. Each paradox challenges our intuition about mathematics, physics, and reality.</p>
    </header>

    <nav>
        <a href="#mathematical">Mathematical</a>
        <a href="#physics">Physics</a>
        <a href="#social">Social</a>
        <a href="#technology">Technology</a>
        <a href="#scientific">Scientific</a>
    </nav>

    <main>
        <!-- MATHEMATICAL PARADOXES -->
        <section id="mathematical">
            <h2 class="category-title">Mathematical & Statistical Paradoxes</h2>

            <!-- Potato Paradox -->
            <div class="paradox-card">
                <h3>Potato Paradox <span class="points">559 pts</span></h3>
                <p class="description">100 lbs of potatoes that are 99% water. After drying to 98% water, they weigh only 50 lbs. A 1% change causes a 50% weight loss!</p>

                <div class="simulator">
                    <h4>Potato Dehydration Simulator</h4>
                    <div class="controls">
                        <div class="control-group">
                            <label>Initial Weight (lbs)</label>
                            <input type="number" id="potato-weight" value="100" min="1" max="1000" oninput="calculatePotato()">
                        </div>
                        <div class="control-group">
                            <label>Initial Water %: <span id="potato-initial-val">99%</span></label>
                            <input type="range" id="potato-initial" min="80" max="99.9" step="0.1" value="99" oninput="calculatePotato()">
                        </div>
                        <div class="control-group">
                            <label>Final Water %: <span id="potato-final-val">98%</span></label>
                            <input type="range" id="potato-final" min="50" max="98.9" step="0.1" value="98" oninput="calculatePotato()">
                        </div>
                    </div>

                    <div class="potato-visualization">
                        <div class="potato-container">
                            <div class="potato-label">BEFORE</div>
                            <div class="potato-stack" id="potato-before-stack">
                                <div class="potato-water" id="potato-before-water"></div>
                                <div class="potato-solid" id="potato-before-solid"></div>
                            </div>
                            <div class="potato-weight" id="potato-before-weight">100 lbs</div>
                            <div class="potato-breakdown">
                                <span class="water-amount" id="potato-before-water-amt">99 lbs water</span>
                                <span class="solid-amount" id="potato-before-solid-amt">1 lb solid</span>
                            </div>
                        </div>

                        <div class="potato-arrow">
                            <div class="arrow-text">Evaporation</div>
                            <div class="arrow-icon">→</div>
                            <div class="water-lost" id="potato-water-lost">-49 lbs water</div>
                        </div>

                        <div class="potato-container">
                            <div class="potato-label">AFTER</div>
                            <div class="potato-stack" id="potato-after-stack">
                                <div class="potato-water" id="potato-after-water"></div>
                                <div class="potato-solid" id="potato-after-solid"></div>
                            </div>
                            <div class="potato-weight" id="potato-after-weight">50 lbs</div>
                            <div class="potato-breakdown">
                                <span class="water-amount" id="potato-after-water-amt">49 lbs water</span>
                                <span class="solid-amount" id="potato-after-solid-amt">1 lb solid</span>
                            </div>
                        </div>
                    </div>

                    <div class="result">
                        <p>Final Weight: <span class="result-value" id="potato-result">50 lbs</span></p>
                        <p>Water % change: <span id="potato-water-change" style="color: var(--accent);">-1%</span> → Weight change: <span id="potato-weight-change" style="color: #ef4444;">-50%</span></p>
                        <p id="potato-explanation">The solid matter (1 lb) stays constant. At 98% water, it must be 2% of total weight. So 1 = 0.02 × weight, meaning weight = 50 lbs.</p>
                    </div>

                    <div class="insight">
                        The paradox shows how percentages near 100% can be deceptive. The "dry matter" is the invariant that reveals the truth.
                    </div>
                </div>

                <style>
                    .potato-visualization {
                        display: flex;
                        justify-content: space-around;
                        align-items: center;
                        padding: 1.5rem;
                        background: var(--bg);
                        border-radius: 0.5rem;
                        margin-top: 1rem;
                        gap: 1rem;
                    }
                    .potato-container {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        flex: 1;
                    }
                    .potato-label {
                        font-weight: bold;
                        color: var(--muted);
                        margin-bottom: 0.5rem;
                        font-size: 0.875rem;
                    }
                    .potato-stack {
                        width: 120px;
                        height: 200px;
                        border: 3px solid var(--muted);
                        border-radius: 0.5rem;
                        display: flex;
                        flex-direction: column;
                        overflow: hidden;
                        position: relative;
                        background: var(--card);
                    }
                    .potato-water {
                        background: linear-gradient(180deg, #3b82f6, #1d4ed8);
                        transition: height 0.5s ease;
                    }
                    .potato-solid {
                        background: linear-gradient(180deg, #a16207, #78350f);
                        transition: height 0.5s ease;
                    }
                    .potato-weight {
                        font-size: 1.5rem;
                        font-weight: bold;
                        color: var(--accent);
                        margin-top: 0.5rem;
                    }
                    .potato-breakdown {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        font-size: 0.75rem;
                        margin-top: 0.25rem;
                    }
                    .water-amount {
                        color: #3b82f6;
                    }
                    .solid-amount {
                        color: #a16207;
                    }
                    .potato-arrow {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        color: var(--muted);
                    }
                    .arrow-text {
                        font-size: 0.75rem;
                    }
                    .arrow-icon {
                        font-size: 2rem;
                        color: var(--primary);
                    }
                    .water-lost {
                        color: #3b82f6;
                        font-size: 0.875rem;
                        font-weight: bold;
                    }
                    @media (max-width: 600px) {
                        .potato-visualization {
                            flex-direction: column;
                        }
                        .potato-arrow {
                            transform: rotate(90deg);
                        }
                    }
                </style>
            </div>

            <!-- Simpson's Paradox -->
            <div class="paradox-card">
                <h3>Simpson's Paradox <span class="points">370 pts</span></h3>
                <p class="description">A trend appears in several groups but disappears or reverses when groups are combined. A treatment can look better in every subgroup but worse overall!</p>

                <div class="simulator">
                    <h4>Medical Treatment Simulator</h4>
                    <p style="color: var(--muted); margin-bottom: 1rem;">Compare success rates of Treatment A vs B across two patient groups</p>

                    <div class="controls">
                        <button onclick="runSimpson()">Generate Example</button>
                        <button onclick="resetSimpson()">Reset</button>
                    </div>

                    <div id="simpson-tables" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div class="stat-box">
                            <h5 style="color: var(--primary); margin-bottom: 0.5rem;">Group: Mild Cases</h5>
                            <p>Treatment A: <span id="simpson-mild-a">-</span></p>
                            <p>Treatment B: <span id="simpson-mild-b">-</span></p>
                            <p style="color: var(--accent);">Winner: <span id="simpson-mild-winner">-</span></p>
                        </div>
                        <div class="stat-box">
                            <h5 style="color: var(--secondary); margin-bottom: 0.5rem;">Group: Severe Cases</h5>
                            <p>Treatment A: <span id="simpson-severe-a">-</span></p>
                            <p>Treatment B: <span id="simpson-severe-b">-</span></p>
                            <p style="color: var(--accent);">Winner: <span id="simpson-severe-winner">-</span></p>
                        </div>
                        <div class="stat-box">
                            <h5 style="color: var(--accent); margin-bottom: 0.5rem;">Combined Data</h5>
                            <p>Treatment A: <span id="simpson-total-a">-</span></p>
                            <p>Treatment B: <span id="simpson-total-b">-</span></p>
                            <p style="color: var(--accent);">Winner: <span id="simpson-total-winner">-</span></p>
                        </div>
                    </div>

                    <div class="result" id="simpson-result" style="display: none;">
                        <p class="result-value" id="simpson-paradox-text">PARADOX DETECTED!</p>
                        <p id="simpson-explanation"></p>
                    </div>

                    <div class="insight">
                        This paradox is why we must be careful with aggregated statistics. The lurking variable (case severity) determines which treatment gets assigned to whom.
                    </div>
                </div>
            </div>

            <!-- St. Petersburg Paradox -->
            <div class="paradox-card">
                <h3>St. Petersburg Paradox <span class="points">144 pts</span></h3>
                <p class="description">A game with INFINITE expected value, yet no rational person would pay much to play. Flip coins until tails - win $2^n where n is the number of flips.</p>

                <div class="simulator">
                    <h4>St. Petersburg Casino</h4>
                    <div class="controls">
                        <div class="control-group">
                            <label>Entry Fee ($)</label>
                            <input type="number" id="stpeter-fee" value="10" min="1" max="1000000">
                        </div>
                        <div class="control-group">
                            <label>Number of Games</label>
                            <input type="number" id="stpeter-games" value="100" min="1" max="10000">
                        </div>
                        <button onclick="playStPetersburg()">Play Games</button>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="stpeter-played">0</div>
                            <div class="stat-label">Games Played</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="stpeter-spent">$0</div>
                            <div class="stat-label">Total Spent</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="stpeter-won">$0</div>
                            <div class="stat-label">Total Won</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="stpeter-profit">$0</div>
                            <div class="stat-label">Net Profit/Loss</div>
                        </div>
                    </div>

                    <div id="stpeter-history" style="margin-top: 1rem; max-height: 150px; overflow-y: auto; font-size: 0.875rem; color: var(--muted);"></div>

                    <div class="result">
                        <p>Expected Value: <span class="result-value">INFINITE</span></p>
                        <p>Mathematical EV = 1/2×$2 + 1/4×$4 + 1/8×$8 + ... = $1 + $1 + $1 + ... = ∞</p>
                    </div>

                    <div class="insight">
                        Despite infinite expected value, most games pay small amounts. Big payoffs are exponentially rare. This is why expected value alone isn't a good decision criterion.
                    </div>
                </div>
            </div>

            <!-- Braess' Paradox -->
            <div class="paradox-card">
                <h3>Braess' Paradox <span class="points">98 pts</span></h3>
                <p class="description">Adding a new road to a traffic network can actually INCREASE travel time for everyone. Removing roads can sometimes improve traffic!</p>

                <div class="simulator">
                    <h4>Traffic Network Simulator</h4>
                    <p style="color: var(--muted); margin-bottom: 1rem;">4000 cars must travel from A to B. Routes have time = (cars/100) or fixed 45 min.</p>

                    <div class="controls">
                        <button id="braess-toggle" onclick="toggleBraessRoad()">Add Shortcut Road</button>
                        <button onclick="resetBraess()">Reset</button>
                    </div>

                    <div class="network-container" id="braess-network">
                        <svg width="100%" height="100%" id="braess-svg">
                            <!-- Will be drawn by JS -->
                        </svg>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="braess-route1">2000</div>
                            <div class="stat-label">Route A→X→B</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="braess-route2">2000</div>
                            <div class="stat-label">Route A→Y→B</div>
                        </div>
                        <div class="stat-box" id="braess-route3-box" style="display: none;">
                            <div class="stat-value" id="braess-route3">0</div>
                            <div class="stat-label">Route A→X→Y→B</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="braess-time">65 min</div>
                            <div class="stat-label">Travel Time</div>
                        </div>
                    </div>

                    <div class="result">
                        <p id="braess-explanation">Without shortcut: Each route has 2000 cars. Time = 20 + 45 = 65 min (equilibrium).</p>
                    </div>

                    <div class="insight">
                        Selfish routing leads to a Nash equilibrium that's worse for everyone. This is why highway planners sometimes close roads to improve traffic!
                    </div>
                </div>
            </div>
        </section>

        <!-- JavaScript for Mathematical Paradoxes -->
        <script>
            // Potato Paradox
            function calculatePotato() {
                const weight = parseFloat(document.getElementById('potato-weight').value) || 100;
                const initialWaterPct = parseFloat(document.getElementById('potato-initial').value);
                const finalWaterPct = parseFloat(document.getElementById('potato-final').value);

                // Update slider labels
                document.getElementById('potato-initial-val').textContent = initialWaterPct + '%';
                document.getElementById('potato-final-val').textContent = finalWaterPct + '%';

                const initialWater = initialWaterPct / 100;
                const finalWater = finalWaterPct / 100;

                // Calculate values
                const solidMatter = weight * (1 - initialWater);
                const initialWaterWeight = weight * initialWater;
                const finalWeight = solidMatter / (1 - finalWater);
                const finalWaterWeight = finalWeight * finalWater;
                const waterLost = initialWaterWeight - finalWaterWeight;

                // Calculate percentage changes
                const waterPctChange = finalWaterPct - initialWaterPct;
                const weightPctChange = ((finalWeight - weight) / weight) * 100;

                // Update text displays
                document.getElementById('potato-result').textContent = finalWeight.toFixed(2) + ' lbs';
                document.getElementById('potato-before-weight').textContent = weight.toFixed(0) + ' lbs';
                document.getElementById('potato-after-weight').textContent = finalWeight.toFixed(2) + ' lbs';

                document.getElementById('potato-before-water-amt').textContent = initialWaterWeight.toFixed(1) + ' lbs water';
                document.getElementById('potato-before-solid-amt').textContent = solidMatter.toFixed(2) + ' lb solid';
                document.getElementById('potato-after-water-amt').textContent = finalWaterWeight.toFixed(1) + ' lbs water';
                document.getElementById('potato-after-solid-amt').textContent = solidMatter.toFixed(2) + ' lb solid';

                document.getElementById('potato-water-lost').textContent = '-' + waterLost.toFixed(1) + ' lbs water';

                document.getElementById('potato-water-change').textContent = waterPctChange.toFixed(1) + '%';
                document.getElementById('potato-weight-change').textContent = weightPctChange.toFixed(1) + '%';

                // Update visual bars (scale height based on weight relative to initial)
                const maxHeight = 200; // matches the CSS height
                const beforeTotalHeight = maxHeight;
                const afterTotalHeight = (finalWeight / weight) * maxHeight;

                // Before stack - full height
                const beforeWaterHeight = initialWater * beforeTotalHeight;
                const beforeSolidHeight = (1 - initialWater) * beforeTotalHeight;
                document.getElementById('potato-before-water').style.height = beforeWaterHeight + 'px';
                document.getElementById('potato-before-solid').style.height = beforeSolidHeight + 'px';

                // After stack - scaled by weight ratio
                const afterWaterHeight = finalWater * afterTotalHeight;
                const afterSolidHeight = (1 - finalWater) * afterTotalHeight;
                document.getElementById('potato-after-water').style.height = afterWaterHeight + 'px';
                document.getElementById('potato-after-solid').style.height = afterSolidHeight + 'px';

                // Update explanation
                document.getElementById('potato-explanation').textContent =
                    `The solid matter (${solidMatter.toFixed(2)} lbs) stays constant. At ${finalWaterPct}% water, solid must be ${(100 - finalWaterPct).toFixed(1)}% of total. ` +
                    `So ${solidMatter.toFixed(2)} = ${(100 - finalWaterPct).toFixed(1)}% × weight → weight = ${finalWeight.toFixed(2)} lbs.`;
            }

            // Simpson's Paradox
            function runSimpson() {
                // Classic Simpson's paradox data
                const mildA = { success: 81, total: 87 };  // 93%
                const mildB = { success: 234, total: 270 }; // 87%
                const severeA = { success: 192, total: 263 }; // 73%
                const severeB = { success: 55, total: 80 };   // 69%

                const totalA = { success: mildA.success + severeA.success, total: mildA.total + severeA.total };
                const totalB = { success: mildB.success + severeB.success, total: mildB.total + severeB.total };

                const pctMildA = (mildA.success / mildA.total * 100).toFixed(1);
                const pctMildB = (mildB.success / mildB.total * 100).toFixed(1);
                const pctSevereA = (severeA.success / severeA.total * 100).toFixed(1);
                const pctSevereB = (severeB.success / severeB.total * 100).toFixed(1);
                const pctTotalA = (totalA.success / totalA.total * 100).toFixed(1);
                const pctTotalB = (totalB.success / totalB.total * 100).toFixed(1);

                document.getElementById('simpson-mild-a').textContent = `${mildA.success}/${mildA.total} (${pctMildA}%)`;
                document.getElementById('simpson-mild-b').textContent = `${mildB.success}/${mildB.total} (${pctMildB}%)`;
                document.getElementById('simpson-mild-winner').textContent = pctMildA > pctMildB ? 'A' : 'B';

                document.getElementById('simpson-severe-a').textContent = `${severeA.success}/${severeA.total} (${pctSevereA}%)`;
                document.getElementById('simpson-severe-b').textContent = `${severeB.success}/${severeB.total} (${pctSevereB}%)`;
                document.getElementById('simpson-severe-winner').textContent = pctSevereA > pctSevereB ? 'A' : 'B';

                document.getElementById('simpson-total-a').textContent = `${totalA.success}/${totalA.total} (${pctTotalA}%)`;
                document.getElementById('simpson-total-b').textContent = `${totalB.success}/${totalB.total} (${pctTotalB}%)`;
                document.getElementById('simpson-total-winner').textContent = pctTotalA > pctTotalB ? 'A' : 'B';

                document.getElementById('simpson-result').style.display = 'block';
                document.getElementById('simpson-explanation').textContent =
                    `Treatment A wins in BOTH subgroups (${pctMildA}% > ${pctMildB}% for mild, ${pctSevereA}% > ${pctSevereB}% for severe). ` +
                    `But Treatment B wins overall (${pctTotalB}% > ${pctTotalA}%)! ` +
                    `This happens because Treatment A was mostly given to severe cases (harder to treat).`;
            }

            function resetSimpson() {
                ['simpson-mild-a', 'simpson-mild-b', 'simpson-severe-a', 'simpson-severe-b',
                 'simpson-total-a', 'simpson-total-b', 'simpson-mild-winner', 'simpson-severe-winner',
                 'simpson-total-winner'].forEach(id => document.getElementById(id).textContent = '-');
                document.getElementById('simpson-result').style.display = 'none';
            }

            // St. Petersburg Paradox
            function playStPetersburg() {
                const fee = parseFloat(document.getElementById('stpeter-fee').value);
                const numGames = parseInt(document.getElementById('stpeter-games').value);

                let totalWon = 0;
                let totalSpent = fee * numGames;
                let history = [];

                for (let i = 0; i < numGames; i++) {
                    let flips = 0;
                    while (Math.random() < 0.5) {
                        flips++;
                    }
                    const prize = Math.pow(2, flips + 1);
                    totalWon += prize;
                    if (flips >= 5 || i < 10) {
                        history.push(`Game ${i + 1}: ${flips + 1} flips → $${prize}`);
                    }
                }

                document.getElementById('stpeter-played').textContent = numGames;
                document.getElementById('stpeter-spent').textContent = '$' + totalSpent.toLocaleString();
                document.getElementById('stpeter-won').textContent = '$' + totalWon.toLocaleString();

                const profit = totalWon - totalSpent;
                const profitEl = document.getElementById('stpeter-profit');
                profitEl.textContent = (profit >= 0 ? '+$' : '-$') + Math.abs(profit).toLocaleString();
                profitEl.style.color = profit >= 0 ? '#22c55e' : '#ef4444';

                document.getElementById('stpeter-history').innerHTML =
                    '<strong>Notable games:</strong><br>' + history.slice(-20).join('<br>');
            }

            // Braess' Paradox
            let braessShortcut = false;

            function drawBraessNetwork() {
                const svg = document.getElementById('braess-svg');
                const w = svg.clientWidth || 400;
                const h = 280;

                const nodes = {
                    A: { x: 50, y: h / 2 },
                    X: { x: w / 2, y: 60 },
                    Y: { x: w / 2, y: h - 60 },
                    B: { x: w - 50, y: h / 2 }
                };

                let html = '';

                // Edges
                const edges = [
                    { from: 'A', to: 'X', label: 'T/100', variable: true },
                    { from: 'X', to: 'B', label: '45 min', variable: false },
                    { from: 'A', to: 'Y', label: '45 min', variable: false },
                    { from: 'Y', to: 'B', label: 'T/100', variable: true }
                ];

                if (braessShortcut) {
                    edges.push({ from: 'X', to: 'Y', label: '0 min', variable: false, shortcut: true });
                }

                edges.forEach(e => {
                    const x1 = nodes[e.from].x, y1 = nodes[e.from].y;
                    const x2 = nodes[e.to].x, y2 = nodes[e.to].y;
                    const color = e.shortcut ? '#f59e0b' : (e.variable ? '#6366f1' : '#64748b');
                    const strokeWidth = e.shortcut ? 4 : 2;

                    html += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${color}" stroke-width="${strokeWidth}"/>`;

                    // Label
                    const mx = (x1 + x2) / 2, my = (y1 + y2) / 2;
                    const offset = e.from === 'A' ? -15 : 15;
                    html += `<text x="${mx}" y="${my + offset}" fill="${color}" font-size="12" text-anchor="middle">${e.label}</text>`;
                });

                // Nodes
                Object.entries(nodes).forEach(([name, pos]) => {
                    html += `<circle cx="${pos.x}" cy="${pos.y}" r="25" fill="${name === 'A' || name === 'B' ? '#6366f1' : '#8b5cf6'}"/>`;
                    html += `<text x="${pos.x}" y="${pos.y + 5}" fill="white" font-size="16" font-weight="bold" text-anchor="middle">${name}</text>`;
                });

                svg.innerHTML = html;
                updateBraessStats();
            }

            function updateBraessStats() {
                if (!braessShortcut) {
                    document.getElementById('braess-route1').textContent = '2000';
                    document.getElementById('braess-route2').textContent = '2000';
                    document.getElementById('braess-time').textContent = '65 min';
                    document.getElementById('braess-route3-box').style.display = 'none';
                    document.getElementById('braess-explanation').textContent =
                        'Without shortcut: Each route has 2000 cars. Time = 20 + 45 = 65 min (Nash equilibrium).';
                } else {
                    document.getElementById('braess-route1').textContent = '0';
                    document.getElementById('braess-route2').textContent = '0';
                    document.getElementById('braess-route3').textContent = '4000';
                    document.getElementById('braess-route3-box').style.display = 'block';
                    document.getElementById('braess-time').textContent = '80 min';
                    document.getElementById('braess-time').style.color = '#ef4444';
                    document.getElementById('braess-explanation').textContent =
                        'With shortcut: Everyone takes A→X→Y→B (Nash equilibrium). Time = 40 + 0 + 40 = 80 min. WORSE for everyone!';
                }
            }

            function toggleBraessRoad() {
                braessShortcut = !braessShortcut;
                document.getElementById('braess-toggle').textContent = braessShortcut ? 'Remove Shortcut Road' : 'Add Shortcut Road';
                document.getElementById('braess-time').style.color = braessShortcut ? '#ef4444' : 'var(--accent)';
                drawBraessNetwork();
            }

            function resetBraess() {
                braessShortcut = false;
                document.getElementById('braess-toggle').textContent = 'Add Shortcut Road';
                document.getElementById('braess-time').style.color = 'var(--accent)';
                drawBraessNetwork();
            }

            // Initialize
            window.addEventListener('load', () => {
                calculatePotato();
                drawBraessNetwork();
            });
            window.addEventListener('resize', drawBraessNetwork);
        </script>

        <!-- PHYSICS PARADOXES -->
        <section id="physics">
            <h2 class="category-title">Physics & Time Paradoxes</h2>

            <!-- Fermi Paradox -->
            <div class="paradox-card">
                <h3>Fermi Paradox <span class="points">223 pts</span></h3>
                <p class="description">Given the high probability of alien civilizations, why have we found no evidence of them? The universe should be teeming with life!</p>

                <div class="simulator">
                    <h4>Drake Equation Calculator</h4>
                    <p style="color: var(--muted); margin-bottom: 1rem;">Estimate the number of civilizations in our galaxy we could communicate with.</p>

                    <div class="controls" style="flex-wrap: wrap;">
                        <div class="control-group">
                            <label>Star formation rate (R*)</label>
                            <input type="range" id="drake-r" min="1" max="10" step="0.5" value="3">
                            <span id="drake-r-val">3/year</span>
                        </div>
                        <div class="control-group">
                            <label>% stars with planets (fp)</label>
                            <input type="range" id="drake-fp" min="10" max="100" step="5" value="100">
                            <span id="drake-fp-val">100%</span>
                        </div>
                        <div class="control-group">
                            <label>Habitable planets per star (ne)</label>
                            <input type="range" id="drake-ne" min="0.1" max="5" step="0.1" value="1">
                            <span id="drake-ne-val">1</span>
                        </div>
                        <div class="control-group">
                            <label>% where life develops (fl)</label>
                            <input type="range" id="drake-fl" min="1" max="100" step="1" value="50">
                            <span id="drake-fl-val">50%</span>
                        </div>
                        <div class="control-group">
                            <label>% with intelligence (fi)</label>
                            <input type="range" id="drake-fi" min="1" max="100" step="1" value="50">
                            <span id="drake-fi-val">50%</span>
                        </div>
                        <div class="control-group">
                            <label>% with technology (fc)</label>
                            <input type="range" id="drake-fc" min="1" max="100" step="1" value="20">
                            <span id="drake-fc-val">20%</span>
                        </div>
                        <div class="control-group">
                            <label>Civilization lifespan (L years)</label>
                            <input type="range" id="drake-l" min="100" max="100000000" step="100" value="10000">
                            <span id="drake-l-val">10,000</span>
                        </div>
                    </div>

                    <div class="result">
                        <p>Estimated Civilizations (N): <span class="result-value" id="drake-result">150</span></p>
                        <p id="drake-formula">N = R* × fp × ne × fl × fi × fc × L</p>
                    </div>

                    <div class="insight">
                        Even conservative estimates suggest thousands of civilizations. Yet we've detected nothing. This is the Fermi Paradox: "Where is everybody?"
                    </div>
                </div>
            </div>

            <!-- Grandfather Paradox -->
            <div class="paradox-card">
                <h3>Grandfather Paradox <span class="points">154 pts</span></h3>
                <p class="description">If you travel back in time and prevent your grandparents from meeting, you'd never be born - so you couldn't have traveled back!</p>

                <div class="simulator">
                    <h4>Time Travel Scenario Simulator</h4>

                    <div class="controls">
                        <button onclick="runGrandfather('standard')">Standard Timeline</button>
                        <button onclick="runGrandfather('paradox')">Paradox Attempt</button>
                        <button onclick="runGrandfather('multiverse')">Multiverse Solution</button>
                    </div>

                    <div id="grandfather-timeline" style="margin-top: 1rem; padding: 1rem; background: var(--bg); border-radius: 0.5rem; min-height: 200px;">
                        <div id="grandfather-viz"></div>
                    </div>

                    <div class="result">
                        <p id="grandfather-result">Select a scenario to see what happens...</p>
                    </div>

                    <div class="insight">
                        Possible resolutions: self-consistency (you can't change what happened), many-worlds (you create a new timeline), or Novikov self-consistency principle.
                    </div>
                </div>
            </div>

            <!-- Olbers' Paradox -->
            <div class="paradox-card">
                <h3>Olbers' Paradox <span class="points">264 pts</span></h3>
                <p class="description">If the universe is infinite and eternal, why isn't the night sky blazingly bright? Every line of sight should hit a star eventually.</p>

                <div class="simulator">
                    <h4>Night Sky Simulator</h4>

                    <div class="controls">
                        <div class="control-group">
                            <label>Universe Age (billions of years)</label>
                            <input type="range" id="olbers-age" min="1" max="1000" value="13.8">
                            <span id="olbers-age-val">13.8 B</span>
                        </div>
                        <div class="control-group">
                            <label>Star Density</label>
                            <input type="range" id="olbers-density" min="1" max="100" value="20">
                            <span id="olbers-density-val">20%</span>
                        </div>
                        <button onclick="drawOlbersSky()">Generate Sky</button>
                    </div>

                    <canvas id="olbers-canvas" width="600" height="200" style="background: #000; width: 100%;"></canvas>

                    <div class="result">
                        <p>Visible Stars: <span class="result-value" id="olbers-stars">0</span></p>
                        <p id="olbers-explanation">In a finite-age universe, light from distant stars hasn't reached us yet.</p>
                    </div>

                    <div class="insight">
                        The dark night sky proves the universe is NOT infinitely old. Light has a speed limit, and distant stars' light hasn't had time to reach us.
                    </div>
                </div>
            </div>
        </section>

        <!-- SOCIAL PARADOXES -->
        <section id="social">
            <h2 class="category-title">Social & Economic Paradoxes</h2>

            <!-- Friendship Paradox -->
            <div class="paradox-card">
                <h3>Friendship Paradox <span class="points">288 pts</span></h3>
                <p class="description">On average, your friends have more friends than you do. This is a mathematical certainty!</p>

                <div class="simulator">
                    <h4>Social Network Simulator</h4>

                    <div class="controls">
                        <div class="control-group">
                            <label>Number of People</label>
                            <input type="number" id="friend-people" value="20" min="5" max="50">
                        </div>
                        <div class="control-group">
                            <label>Connection Probability</label>
                            <input type="range" id="friend-prob" min="10" max="60" value="25">
                            <span id="friend-prob-val">25%</span>
                        </div>
                        <button onclick="generateFriendNetwork()">Generate Network</button>
                    </div>

                    <canvas id="friend-canvas" width="600" height="300" style="width: 100%; border-radius: 0.5rem;"></canvas>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="friend-avg">0</div>
                            <div class="stat-label">Avg Friends</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="friend-fof">0</div>
                            <div class="stat-label">Avg Friends-of-Friends</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="friend-pct">0%</div>
                            <div class="stat-label">People w/ Less Popular Friends</div>
                        </div>
                    </div>

                    <div class="result">
                        <p id="friend-explanation">Generate a network to see the paradox in action!</p>
                    </div>

                    <div class="insight">
                        This isn't just statistics - it affects your perception of social media. You see your popular friends' posts more, making everyone seem more social than you.
                    </div>
                </div>
            </div>

            <!-- Jevons Paradox -->
            <div class="paradox-card">
                <h3>Jevons Paradox <span class="points">98 pts</span></h3>
                <p class="description">Increasing efficiency in resource use often leads to INCREASED total consumption, not decreased!</p>

                <div class="simulator">
                    <h4>Fuel Efficiency Simulator</h4>

                    <div class="controls">
                        <div class="control-group">
                            <label>Initial MPG</label>
                            <input type="number" id="jevons-mpg1" value="20" min="10" max="50">
                        </div>
                        <div class="control-group">
                            <label>Improved MPG</label>
                            <input type="number" id="jevons-mpg2" value="40" min="15" max="100">
                        </div>
                        <div class="control-group">
                            <label>Rebound Effect %</label>
                            <input type="range" id="jevons-rebound" min="0" max="200" value="120">
                            <span id="jevons-rebound-val">120%</span>
                        </div>
                        <button onclick="calculateJevons()">Calculate Impact</button>
                    </div>

                    <div class="bar-chart" style="height: 150px;">
                        <div class="bar-group">
                            <div class="bar" id="jevons-bar1" style="height: 50%;"></div>
                            <div class="bar-label">Miles Driven<br>(Before)</div>
                        </div>
                        <div class="bar-group">
                            <div class="bar second" id="jevons-bar2" style="height: 60%;"></div>
                            <div class="bar-label">Miles Driven<br>(After)</div>
                        </div>
                        <div class="bar-group">
                            <div class="bar" id="jevons-bar3" style="height: 50%;"></div>
                            <div class="bar-label">Fuel Used<br>(Before)</div>
                        </div>
                        <div class="bar-group">
                            <div class="bar second" id="jevons-bar4" style="height: 55%;"></div>
                            <div class="bar-label">Fuel Used<br>(After)</div>
                        </div>
                    </div>

                    <div class="result">
                        <p>Expected Fuel Savings: <span id="jevons-expected">-50%</span></p>
                        <p>Actual Fuel Change: <span class="result-value" id="jevons-actual">+10%</span></p>
                    </div>

                    <div class="insight">
                        When driving costs half as much per mile, people drive more. Energy efficiency improvements often don't reduce consumption as expected.
                    </div>
                </div>
            </div>

            <!-- Waiting Time Paradox -->
            <div class="paradox-card">
                <h3>Waiting Time Paradox <span class="points">345 pts</span></h3>
                <p class="description">If buses arrive every 10 minutes on average, your expected wait is NOT 5 minutes - it's longer!</p>

                <div class="simulator">
                    <h4>Bus Stop Simulator</h4>

                    <div class="controls">
                        <div class="control-group">
                            <label>Average Interval (min)</label>
                            <input type="number" id="bus-interval" value="10" min="1" max="60">
                        </div>
                        <div class="control-group">
                            <label>Variability (0=exact, 100=random)</label>
                            <input type="range" id="bus-variance" min="0" max="100" value="70">
                            <span id="bus-variance-val">70%</span>
                        </div>
                        <div class="control-group">
                            <label>Simulations</label>
                            <input type="number" id="bus-sims" value="1000" min="100" max="10000">
                        </div>
                        <button onclick="simulateBus()">Simulate Arrivals</button>
                    </div>

                    <div id="bus-viz" style="height: 80px; background: var(--bg); border-radius: 0.5rem; position: relative; overflow: hidden; margin-top: 1rem;">
                        <div style="position: absolute; top: 50%; left: 0; right: 0; height: 4px; background: var(--muted);"></div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="bus-expected">5 min</div>
                            <div class="stat-label">Naive Expectation</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="bus-actual">7.5 min</div>
                            <div class="stat-label">Actual Avg Wait</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="bus-ratio">1.5x</div>
                            <div class="stat-label">Longer Than Expected</div>
                        </div>
                    </div>

                    <div class="result">
                        <p id="bus-explanation">You're more likely to arrive during a LONG gap than a short one. The average gap you experience is longer than the average gap between buses.</p>
                    </div>

                    <div class="insight">
                        This is called the "inspection paradox" - you're sampling intervals proportional to their length. It explains why buses seem late!
                    </div>
                </div>
            </div>
        </section>

        <script>
            // Drake Equation (Fermi Paradox)
            function updateDrake() {
                const R = parseFloat(document.getElementById('drake-r').value);
                const fp = parseFloat(document.getElementById('drake-fp').value) / 100;
                const ne = parseFloat(document.getElementById('drake-ne').value);
                const fl = parseFloat(document.getElementById('drake-fl').value) / 100;
                const fi = parseFloat(document.getElementById('drake-fi').value) / 100;
                const fc = parseFloat(document.getElementById('drake-fc').value) / 100;
                const L = parseFloat(document.getElementById('drake-l').value);

                document.getElementById('drake-r-val').textContent = R + '/year';
                document.getElementById('drake-fp-val').textContent = (fp * 100) + '%';
                document.getElementById('drake-ne-val').textContent = ne;
                document.getElementById('drake-fl-val').textContent = (fl * 100) + '%';
                document.getElementById('drake-fi-val').textContent = (fi * 100) + '%';
                document.getElementById('drake-fc-val').textContent = (fc * 100) + '%';
                document.getElementById('drake-l-val').textContent = L.toLocaleString();

                const N = R * fp * ne * fl * fi * fc * L;
                document.getElementById('drake-result').textContent = Math.round(N).toLocaleString();
            }

            ['drake-r', 'drake-fp', 'drake-ne', 'drake-fl', 'drake-fi', 'drake-fc', 'drake-l'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateDrake);
            });

            // Grandfather Paradox
            function runGrandfather(scenario) {
                const viz = document.getElementById('grandfather-viz');
                const result = document.getElementById('grandfather-result');

                if (scenario === 'standard') {
                    viz.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem; margin: 1rem 0;">
                            <div style="background: var(--primary); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                                1950<br>Grandparents meet
                            </div>
                            <div style="font-size: 2rem;">→</div>
                            <div style="background: var(--secondary); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                                1975<br>Parents born
                            </div>
                            <div style="font-size: 2rem;">→</div>
                            <div style="background: var(--accent); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                                2000<br>You are born
                            </div>
                            <div style="font-size: 2rem;">→</div>
                            <div style="background: #22c55e; padding: 1rem; border-radius: 0.5rem; text-align: center;">
                                2025<br>Present day
                            </div>
                        </div>`;
                    result.innerHTML = '<span style="color: #22c55e;">Standard timeline: Everything is consistent.</span>';
                } else if (scenario === 'paradox') {
                    viz.innerHTML = `
                        <div style="display: flex; flex-direction: column; gap: 1rem; margin: 1rem 0;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="background: var(--primary); padding: 1rem; border-radius: 0.5rem;">2025: You build time machine</div>
                                <div style="font-size: 2rem;">→</div>
                                <div style="background: var(--secondary); padding: 1rem; border-radius: 0.5rem;">1950: Prevent grandparents meeting</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-left: 2rem;">
                                <div style="font-size: 2rem;">↓</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="background: #ef4444; padding: 1rem; border-radius: 0.5rem;">Parents never born</div>
                                <div style="font-size: 2rem;">→</div>
                                <div style="background: #ef4444; padding: 1rem; border-radius: 0.5rem;">You never born</div>
                                <div style="font-size: 2rem;">→</div>
                                <div style="background: #ef4444; padding: 1rem; border-radius: 0.5rem;">Can't travel back???</div>
                            </div>
                        </div>`;
                    result.innerHTML = '<span style="color: #ef4444;">PARADOX! If you were never born, who prevented the meeting? Logical impossibility!</span>';
                } else {
                    viz.innerHTML = `
                        <div style="display: flex; flex-direction: column; gap: 0.5rem; margin: 1rem 0;">
                            <div style="background: var(--primary); padding: 0.5rem; border-radius: 0.5rem;">Timeline A (original): You are born → Travel back</div>
                            <div style="margin-left: 15rem; font-size: 1.5rem;">↘</div>
                            <div style="background: var(--secondary); padding: 0.5rem; border-radius: 0.5rem; margin-left: 2rem;">Timeline B (new): Grandparents don't meet → Different universe</div>
                            <div style="margin-left: 1rem; font-size: 1.5rem;">↓</div>
                            <div style="background: var(--accent); padding: 0.5rem; border-radius: 0.5rem;">Timeline A continues: You still exist in original timeline!</div>
                        </div>`;
                    result.innerHTML = '<span style="color: #22c55e;">Many-Worlds Solution: You create a new branch. Both timelines exist independently. No paradox!</span>';
                }
            }

            // Olbers' Paradox
            function drawOlbersSky() {
                const canvas = document.getElementById('olbers-canvas');
                const ctx = canvas.getContext('2d');
                const age = parseFloat(document.getElementById('olbers-age').value);
                const density = parseFloat(document.getElementById('olbers-density').value);

                document.getElementById('olbers-age-val').textContent = age + ' B';
                document.getElementById('olbers-density-val').textContent = density + '%';

                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Calculate visible stars based on light travel time
                const maxLightYears = age * 1e9; // Light years
                const universeRadius = 93e9; // Observable universe radius
                const visibilityFactor = Math.min(maxLightYears / universeRadius, 1);

                const numStars = Math.floor(density * visibilityFactor * 5);

                for (let i = 0; i < numStars; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const size = Math.random() * 2 + 0.5;
                    const brightness = Math.random() * 0.8 + 0.2;

                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${brightness})`;
                    ctx.fill();
                }

                // If infinite age/density, fill with white
                if (age > 500 && density > 80) {
                    ctx.fillStyle = `rgba(255, 255, 200, ${(age - 500) / 500 * (density / 100)})`;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                document.getElementById('olbers-stars').textContent = numStars;

                if (age > 500) {
                    document.getElementById('olbers-explanation').textContent =
                        'With an old enough universe, every line of sight hits a star. The sky would be blindingly bright!';
                } else {
                    document.getElementById('olbers-explanation').textContent =
                        `At ${age}B years old, light has only traveled ${(age * 1e9).toExponential(1)} light years. Many stars remain invisible.`;
                }
            }

            document.getElementById('olbers-age').addEventListener('input', function() {
                document.getElementById('olbers-age-val').textContent = this.value + ' B';
            });
            document.getElementById('olbers-density').addEventListener('input', function() {
                document.getElementById('olbers-density-val').textContent = this.value + '%';
            });

            // Friendship Paradox
            let friendNetwork = [];

            function generateFriendNetwork() {
                const n = parseInt(document.getElementById('friend-people').value);
                const prob = parseFloat(document.getElementById('friend-prob').value) / 100;
                document.getElementById('friend-prob-val').textContent = (prob * 100) + '%';

                // Generate adjacency
                const adj = Array(n).fill(null).map(() => []);

                for (let i = 0; i < n; i++) {
                    for (let j = i + 1; j < n; j++) {
                        if (Math.random() < prob) {
                            adj[i].push(j);
                            adj[j].push(i);
                        }
                    }
                }

                // Calculate stats
                const friendCounts = adj.map(a => a.length);
                const avgFriends = friendCounts.reduce((a, b) => a + b, 0) / n;

                // Average friends-of-friends
                let totalFoF = 0;
                let totalConnections = 0;
                for (let i = 0; i < n; i++) {
                    for (const friend of adj[i]) {
                        totalFoF += adj[friend].length;
                        totalConnections++;
                    }
                }
                const avgFoF = totalConnections > 0 ? totalFoF / totalConnections : 0;

                // Count people with less popular friends
                let lessPopular = 0;
                for (let i = 0; i < n; i++) {
                    if (adj[i].length > 0) {
                        const friendAvg = adj[i].reduce((sum, f) => sum + adj[f].length, 0) / adj[i].length;
                        if (adj[i].length < friendAvg) lessPopular++;
                    }
                }

                document.getElementById('friend-avg').textContent = avgFriends.toFixed(1);
                document.getElementById('friend-fof').textContent = avgFoF.toFixed(1);
                document.getElementById('friend-pct').textContent = Math.round(lessPopular / n * 100) + '%';

                document.getElementById('friend-explanation').textContent =
                    `Your friends have ${avgFoF.toFixed(1)} friends on average, while you have ${avgFriends.toFixed(1)}. ` +
                    `${Math.round(lessPopular / n * 100)}% of people have friends more popular than themselves!`;

                // Draw network
                const canvas = document.getElementById('friend-canvas');
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#1e293b';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Position nodes in a circle
                const cx = canvas.width / 2;
                const cy = canvas.height / 2;
                const radius = Math.min(cx, cy) - 40;

                const positions = [];
                for (let i = 0; i < n; i++) {
                    const angle = (2 * Math.PI * i) / n - Math.PI / 2;
                    positions.push({
                        x: cx + radius * Math.cos(angle),
                        y: cy + radius * Math.sin(angle)
                    });
                }

                // Draw edges
                ctx.strokeStyle = 'rgba(99, 102, 241, 0.3)';
                ctx.lineWidth = 1;
                for (let i = 0; i < n; i++) {
                    for (const j of adj[i]) {
                        if (j > i) {
                            ctx.beginPath();
                            ctx.moveTo(positions[i].x, positions[i].y);
                            ctx.lineTo(positions[j].x, positions[j].y);
                            ctx.stroke();
                        }
                    }
                }

                // Draw nodes (size by popularity)
                const maxFriends = Math.max(...friendCounts, 1);
                for (let i = 0; i < n; i++) {
                    const nodeSize = 5 + (friendCounts[i] / maxFriends) * 15;
                    ctx.beginPath();
                    ctx.arc(positions[i].x, positions[i].y, nodeSize, 0, Math.PI * 2);
                    ctx.fillStyle = friendCounts[i] >= avgFriends ? '#6366f1' : '#ef4444';
                    ctx.fill();
                }
            }

            document.getElementById('friend-prob').addEventListener('input', function() {
                document.getElementById('friend-prob-val').textContent = this.value + '%';
            });

            // Jevons Paradox
            function calculateJevons() {
                const mpg1 = parseFloat(document.getElementById('jevons-mpg1').value);
                const mpg2 = parseFloat(document.getElementById('jevons-mpg2').value);
                const rebound = parseFloat(document.getElementById('jevons-rebound').value) / 100;

                document.getElementById('jevons-rebound-val').textContent = (rebound * 100) + '%';

                // Base: 12000 miles/year
                const baseMiles = 12000;
                const efficiencyGain = (mpg2 - mpg1) / mpg1;

                // With rebound effect, increased efficiency leads to more driving
                const newMiles = baseMiles * (1 + efficiencyGain * rebound);

                const baseFuel = baseMiles / mpg1;
                const newFuel = newMiles / mpg2;

                const expectedSaving = (1 - mpg1 / mpg2) * 100;
                const actualChange = (newFuel / baseFuel - 1) * 100;

                // Update bars
                const maxMiles = Math.max(baseMiles, newMiles);
                const maxFuel = Math.max(baseFuel, newFuel);

                document.getElementById('jevons-bar1').style.height = (baseMiles / maxMiles * 120) + 'px';
                document.getElementById('jevons-bar2').style.height = (newMiles / maxMiles * 120) + 'px';
                document.getElementById('jevons-bar3').style.height = (baseFuel / maxFuel * 120) + 'px';
                document.getElementById('jevons-bar4').style.height = (newFuel / maxFuel * 120) + 'px';

                document.getElementById('jevons-expected').textContent = expectedSaving.toFixed(0) + '%';
                document.getElementById('jevons-expected').style.color = '#22c55e';

                const actualEl = document.getElementById('jevons-actual');
                actualEl.textContent = (actualChange >= 0 ? '+' : '') + actualChange.toFixed(0) + '%';
                actualEl.style.color = actualChange >= 0 ? '#ef4444' : '#22c55e';
            }

            document.getElementById('jevons-rebound').addEventListener('input', function() {
                document.getElementById('jevons-rebound-val').textContent = this.value + '%';
            });

            // Waiting Time Paradox
            function simulateBus() {
                const interval = parseFloat(document.getElementById('bus-interval').value);
                const variance = parseFloat(document.getElementById('bus-variance').value) / 100;
                const numSims = parseInt(document.getElementById('bus-sims').value);

                document.getElementById('bus-variance-val').textContent = (variance * 100) + '%';

                // Generate bus arrival times
                const arrivals = [0];
                let time = 0;
                while (time < 10000) {
                    // Exponential distribution with given variance
                    const gap = variance > 0 ?
                        -interval * Math.log(Math.random()) * variance + interval * (1 - variance) :
                        interval;
                    time += Math.max(0.1, gap);
                    arrivals.push(time);
                }

                // Simulate random passenger arrivals
                let totalWait = 0;
                for (let i = 0; i < numSims; i++) {
                    const arrivalTime = Math.random() * (arrivals[arrivals.length - 2]);
                    // Find next bus
                    for (const busTime of arrivals) {
                        if (busTime >= arrivalTime) {
                            totalWait += (busTime - arrivalTime);
                            break;
                        }
                    }
                }

                const avgWait = totalWait / numSims;
                const expected = interval / 2;
                const ratio = avgWait / expected;

                document.getElementById('bus-expected').textContent = expected.toFixed(1) + ' min';
                document.getElementById('bus-actual').textContent = avgWait.toFixed(1) + ' min';
                document.getElementById('bus-actual').style.color = avgWait > expected ? '#ef4444' : '#22c55e';
                document.getElementById('bus-ratio').textContent = ratio.toFixed(2) + 'x';

                // Visualize some arrivals
                const viz = document.getElementById('bus-viz');
                viz.innerHTML = '<div style="position: absolute; top: 50%; left: 0; right: 0; height: 4px; background: var(--muted);"></div>';

                const displayArrivals = arrivals.slice(0, 20);
                const maxTime = displayArrivals[displayArrivals.length - 1];

                displayArrivals.forEach((t, i) => {
                    const left = (t / maxTime) * 100;
                    const marker = document.createElement('div');
                    marker.style.cssText = `position: absolute; left: ${left}%; top: 30%; width: 20px; height: 30px; background: var(--primary); border-radius: 4px; transform: translateX(-50%);`;
                    marker.title = `Bus at ${t.toFixed(1)} min`;
                    viz.appendChild(marker);
                });
            }

            document.getElementById('bus-variance').addEventListener('input', function() {
                document.getElementById('bus-variance-val').textContent = this.value + '%';
            });

            // Initialize
            window.addEventListener('load', () => {
                updateDrake();
                drawOlbersSky();
                generateFriendNetwork();
                calculateJevons();
                simulateBus();
            });
        </script>

        <!-- TECHNOLOGY PARADOXES -->
        <section id="technology">
            <h2 class="category-title">Technology & Computing Paradoxes</h2>

            <!-- Moravec's Paradox -->
            <div class="paradox-card">
                <h3>Moravec's Paradox <span class="points">155 pts</span></h3>
                <p class="description">Tasks easy for humans (walking, face recognition) are hard for computers. Tasks hard for humans (chess, math) are easy for computers!</p>

                <div class="simulator">
                    <h4>Human vs AI Task Difficulty</h4>
                    <p style="color: var(--muted); margin-bottom: 1rem;">Compare the relative difficulty of tasks for humans vs AI systems.</p>

                    <div id="moravec-chart" style="display: grid; gap: 0.5rem;">
                        <div class="moravec-row" data-human="1" data-ai="95">
                            <span class="moravec-label">Walking on uneven terrain</span>
                            <div class="moravec-bars">
                                <div class="moravec-human" style="width: 10%;">Human: Easy</div>
                                <div class="moravec-ai" style="width: 95%;">AI: Hard</div>
                            </div>
                        </div>
                        <div class="moravec-row" data-human="2" data-ai="90">
                            <span class="moravec-label">Recognizing faces</span>
                            <div class="moravec-bars">
                                <div class="moravec-human" style="width: 20%;">Human: Easy</div>
                                <div class="moravec-ai" style="width: 70%;">AI: Hard (improving)</div>
                            </div>
                        </div>
                        <div class="moravec-row" data-human="3" data-ai="85">
                            <span class="moravec-label">Understanding sarcasm</span>
                            <div class="moravec-bars">
                                <div class="moravec-human" style="width: 30%;">Human: Easy</div>
                                <div class="moravec-ai" style="width: 85%;">AI: Hard</div>
                            </div>
                        </div>
                        <div class="moravec-row" data-human="5" data-ai="70">
                            <span class="moravec-label">Common sense reasoning</span>
                            <div class="moravec-bars">
                                <div class="moravec-human" style="width: 50%;">Human: Medium</div>
                                <div class="moravec-ai" style="width: 70%;">AI: Hard</div>
                            </div>
                        </div>
                        <div class="moravec-row" data-human="85" data-ai="5">
                            <span class="moravec-label">Chess (grandmaster level)</span>
                            <div class="moravec-bars">
                                <div class="moravec-human" style="width: 85%;">Human: Very Hard</div>
                                <div class="moravec-ai" style="width: 5%;">AI: Trivial</div>
                            </div>
                        </div>
                        <div class="moravec-row" data-human="90" data-ai="3">
                            <span class="moravec-label">Complex calculations</span>
                            <div class="moravec-bars">
                                <div class="moravec-human" style="width: 90%;">Human: Very Hard</div>
                                <div class="moravec-ai" style="width: 3%;">AI: Trivial</div>
                            </div>
                        </div>
                        <div class="moravec-row" data-human="95" data-ai="2">
                            <span class="moravec-label">Searching billions of records</span>
                            <div class="moravec-bars">
                                <div class="moravec-human" style="width: 95%;">Human: Impossible</div>
                                <div class="moravec-ai" style="width: 2%;">AI: Trivial</div>
                            </div>
                        </div>
                    </div>

                    <div class="result">
                        <p id="moravec-explanation">Evolution spent billions of years optimizing sensorimotor skills. Abstract thinking is new and inefficient - but easily automated!</p>
                    </div>

                    <div class="insight">
                        This is why self-driving cars are harder than chess-playing AI. Moving through the physical world requires solving problems evolution already solved for us.
                    </div>
                </div>

                <style>
                    .moravec-row {
                        display: grid;
                        grid-template-columns: 200px 1fr;
                        gap: 1rem;
                        align-items: center;
                        padding: 0.5rem;
                        background: var(--bg);
                        border-radius: 0.25rem;
                    }
                    .moravec-label {
                        font-size: 0.875rem;
                    }
                    .moravec-bars {
                        display: flex;
                        flex-direction: column;
                        gap: 0.25rem;
                    }
                    .moravec-human {
                        background: linear-gradient(90deg, #22c55e, #84cc16);
                        padding: 0.25rem 0.5rem;
                        border-radius: 0.25rem;
                        font-size: 0.75rem;
                        min-width: 80px;
                    }
                    .moravec-ai {
                        background: linear-gradient(90deg, #6366f1, #8b5cf6);
                        padding: 0.25rem 0.5rem;
                        border-radius: 0.25rem;
                        font-size: 0.75rem;
                        min-width: 80px;
                    }
                </style>
            </div>

            <!-- Tog's Paradox -->
            <div class="paradox-card">
                <h3>Tog's Paradox <span class="points">260 pts</span></h3>
                <p class="description">Users believe they're faster with keyboard shortcuts, but studies show mouse users are often faster. The feeling of speed doesn't match reality!</p>

                <div class="simulator">
                    <h4>Keyboard vs Mouse Speed Test</h4>
                    <p style="color: var(--muted); margin-bottom: 1rem;">Test your speed: Click the targets or use keyboard shortcuts.</p>

                    <div class="controls">
                        <button onclick="startTogTest('mouse')">Start Mouse Test</button>
                        <button onclick="startTogTest('keyboard')">Start Keyboard Test (use 1-9)</button>
                        <button onclick="resetTogTest()">Reset</button>
                    </div>

                    <div id="tog-arena" style="height: 250px; background: var(--bg); border-radius: 0.5rem; position: relative; margin-top: 1rem; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 0.5rem; padding: 0.5rem;">
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="tog-mouse-time">-</div>
                            <div class="stat-label">Mouse Time</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="tog-keyboard-time">-</div>
                            <div class="stat-label">Keyboard Time</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="tog-mouse-feel">-</div>
                            <div class="stat-label">Mouse Felt</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="tog-keyboard-feel">-</div>
                            <div class="stat-label">Keyboard Felt</div>
                        </div>
                    </div>

                    <div class="result">
                        <p id="tog-result">Run both tests to compare!</p>
                    </div>

                    <div class="insight">
                        Keyboard shortcuts feel faster because they require conscious attention. Mouse movements are automatic, making them feel "passive" - but they're often quicker!
                    </div>
                </div>
            </div>

            <!-- Solow Paradox -->
            <div class="paradox-card">
                <h3>Solow Paradox <span class="points">97 pts</span></h3>
                <p class="description">"You can see the computer age everywhere but in the productivity statistics." Despite massive IT investment, productivity gains have been disappointing.</p>

                <div class="simulator">
                    <h4>IT Investment vs Productivity</h4>

                    <div id="solow-chart" style="padding: 1rem; background: var(--bg); border-radius: 0.5rem;">
                        <canvas id="solow-canvas" width="600" height="250" style="width: 100%;"></canvas>
                    </div>

                    <div class="controls" style="margin-top: 1rem;">
                        <button onclick="drawSolowChart()">Animate Chart</button>
                    </div>

                    <div class="result">
                        <p>IT Spending Growth: <span style="color: var(--primary);">+2000%</span> (1980-2020)</p>
                        <p>Productivity Growth: <span style="color: var(--accent);">+50%</span> (same period)</p>
                    </div>

                    <div class="insight">
                        Possible explanations: measurement problems, lag time, distractions (email, social media), or computers replacing easy tasks leaving hard ones.
                    </div>
                </div>
            </div>
        </section>

        <!-- SCIENTIFIC PARADOXES -->
        <section id="scientific">
            <h2 class="category-title">Scientific & Philosophical Paradoxes</h2>

            <!-- Peto's Paradox -->
            <div class="paradox-card">
                <h3>Peto's Paradox <span class="points">142 pts</span></h3>
                <p class="description">Large animals like elephants should have much higher cancer rates (more cells = more chances for cancer), but they don't!</p>

                <div class="simulator">
                    <h4>Cancer Risk Calculator</h4>
                    <p style="color: var(--muted); margin-bottom: 1rem;">Compare expected vs actual cancer rates based on body size.</p>

                    <div id="peto-animals" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        <div class="peto-animal" data-cells="37e12" data-expected="12" data-actual="25">
                            <div class="peto-icon">Human</div>
                            <div class="peto-cells">37 trillion cells</div>
                            <div class="peto-expected">Expected: 12%</div>
                            <div class="peto-actual">Actual: 25%</div>
                        </div>
                        <div class="peto-animal" data-cells="3e15" data-expected="80" data-actual="5">
                            <div class="peto-icon">Elephant</div>
                            <div class="peto-cells">3 quadrillion cells</div>
                            <div class="peto-expected">Expected: 80%+</div>
                            <div class="peto-actual actual-low">Actual: ~5%</div>
                        </div>
                        <div class="peto-animal" data-cells="1e16" data-expected="99" data-actual="2">
                            <div class="peto-icon">Blue Whale</div>
                            <div class="peto-cells">10 quadrillion cells</div>
                            <div class="peto-expected">Expected: 99%+</div>
                            <div class="peto-actual actual-low">Actual: ~2%</div>
                        </div>
                        <div class="peto-animal" data-cells="1e10" data-expected="3" data-actual="30">
                            <div class="peto-icon">Mouse</div>
                            <div class="peto-cells">10 billion cells</div>
                            <div class="peto-expected">Expected: 3%</div>
                            <div class="peto-actual actual-high">Actual: 30%+</div>
                        </div>
                    </div>

                    <div class="result">
                        <p>Elephants have 20 copies of the p53 tumor suppressor gene. Humans have only 2!</p>
                    </div>

                    <div class="insight">
                        Large, long-lived animals evolved enhanced cancer suppression. This paradox is helping develop new cancer treatments for humans.
                    </div>
                </div>

                <style>
                    .peto-animal {
                        background: var(--bg);
                        padding: 1rem;
                        border-radius: 0.5rem;
                        text-align: center;
                    }
                    .peto-icon {
                        font-size: 1.25rem;
                        font-weight: bold;
                        color: var(--primary);
                        margin-bottom: 0.5rem;
                    }
                    .peto-cells {
                        font-size: 0.75rem;
                        color: var(--muted);
                    }
                    .peto-expected {
                        color: #ef4444;
                        margin-top: 0.5rem;
                    }
                    .peto-actual {
                        color: var(--accent);
                        font-weight: bold;
                    }
                    .peto-actual.actual-low {
                        color: #22c55e;
                    }
                    .peto-actual.actual-high {
                        color: #ef4444;
                    }
                </style>
            </div>

            <!-- Efficient Market Paradox -->
            <div class="paradox-card">
                <h3>Efficient Market Paradox <span class="points">95 pts</span></h3>
                <p class="description">If markets are perfectly efficient, there's no point analyzing stocks. But if nobody analyzes, markets can't be efficient!</p>

                <div class="simulator">
                    <h4>Market Efficiency Simulator</h4>

                    <div class="controls">
                        <div class="control-group">
                            <label>% of Analysts Active</label>
                            <input type="range" id="market-analysts" min="0" max="100" value="50">
                            <span id="market-analysts-val">50%</span>
                        </div>
                        <button onclick="simulateMarket()">Run Simulation</button>
                    </div>

                    <canvas id="market-canvas" width="600" height="200" style="width: 100%; margin-top: 1rem; border-radius: 0.5rem;"></canvas>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="market-efficiency">50%</div>
                            <div class="stat-label">Market Efficiency</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="market-profit">$0</div>
                            <div class="stat-label">Analyst Avg Profit</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="market-worth">Maybe</div>
                            <div class="stat-label">Analysis Worth It?</div>
                        </div>
                    </div>

                    <div class="result">
                        <p id="market-explanation">The paradox: If everyone believes markets are efficient and stops analyzing, inefficiencies emerge. Analysis is only profitable when enough people DON'T analyze!</p>
                    </div>

                    <div class="insight">
                        This creates an equilibrium where just enough analysts exist to keep markets mostly-but-not-perfectly efficient.
                    </div>
                </div>
            </div>

            <!-- Tolerance Paradox (Popper) -->
            <div class="paradox-card">
                <h3>Tolerance Paradox <span class="points">147 pts</span></h3>
                <p class="description">A tolerant society must be intolerant of intolerance, otherwise the intolerant will destroy tolerance itself.</p>

                <div class="simulator">
                    <h4>Society Tolerance Simulator</h4>

                    <div class="controls">
                        <div class="control-group">
                            <label>Tolerance Policy</label>
                            <select id="tolerance-policy" onchange="runToleranceSim()">
                                <option value="unlimited">Unlimited Tolerance</option>
                                <option value="paradox" selected>Tolerant (Popper's Rule)</option>
                                <option value="low">Low Tolerance</option>
                            </select>
                        </div>
                        <button onclick="runToleranceSim()">Simulate 50 Years</button>
                    </div>

                    <div id="tolerance-viz" style="margin-top: 1rem; padding: 1rem; background: var(--bg); border-radius: 0.5rem;">
                        <div id="tolerance-timeline" style="display: flex; gap: 2px; height: 100px; align-items: flex-end;"></div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="tolerance-final">0%</div>
                            <div class="stat-label">Society Tolerance (Final)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="tolerance-intolerant">0%</div>
                            <div class="stat-label">Intolerant Population</div>
                        </div>
                    </div>

                    <div class="result">
                        <p id="tolerance-result">Select a policy and run the simulation.</p>
                    </div>

                    <div class="insight">
                        Karl Popper: "If we extend unlimited tolerance even to those who are intolerant... then the tolerant will be destroyed, and tolerance with them."
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer style="text-align: center; padding: 2rem; color: var(--muted); border-top: 1px solid var(--card); margin-top: 2rem;">
            <p>Data sourced from <a href="https://hn.algolia.com/?query=paradox" style="color: var(--primary);">Hacker News</a></p>
            <p style="font-size: 0.875rem; margin-top: 0.5rem;">Interactive paradox simulators - explore the counterintuitive nature of reality</p>
        </footer>

        <script>
            // Tog's Paradox - Speed Test
            let togMode = null;
            let togTargetIndex = 0;
            let togStartTime = 0;
            let togTargets = [];
            let togMouseTime = null;
            let togKeyboardTime = null;

            function startTogTest(mode) {
                togMode = mode;
                togTargetIndex = 0;
                togTargets = Array.from({length: 9}, (_, i) => i + 1).sort(() => Math.random() - 0.5);

                const arena = document.getElementById('tog-arena');
                arena.innerHTML = '';

                for (let i = 1; i <= 9; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.style.cssText = `
                        background: var(--card);
                        border: 2px solid var(--muted);
                        color: var(--text);
                        font-size: 1.5rem;
                        font-weight: bold;
                        cursor: pointer;
                        border-radius: 0.5rem;
                        transition: all 0.1s;
                    `;
                    btn.dataset.num = i;
                    btn.onclick = () => handleTogClick(i);
                    arena.appendChild(btn);
                }

                highlightTogTarget();
                togStartTime = performance.now();

                if (mode === 'keyboard') {
                    document.addEventListener('keydown', handleTogKey);
                }
            }

            function highlightTogTarget() {
                const arena = document.getElementById('tog-arena');
                const buttons = arena.querySelectorAll('button');

                buttons.forEach(btn => {
                    btn.style.background = 'var(--card)';
                    btn.style.borderColor = 'var(--muted)';
                });

                if (togTargetIndex < togTargets.length) {
                    const targetNum = togTargets[togTargetIndex];
                    const targetBtn = Array.from(buttons).find(b => b.dataset.num == targetNum);
                    if (targetBtn) {
                        targetBtn.style.background = 'var(--primary)';
                        targetBtn.style.borderColor = 'var(--accent)';
                    }
                }
            }

            function handleTogClick(num) {
                if (togMode !== 'mouse') return;
                if (num === togTargets[togTargetIndex]) {
                    togTargetIndex++;
                    if (togTargetIndex >= togTargets.length) {
                        endTogTest();
                    } else {
                        highlightTogTarget();
                    }
                }
            }

            function handleTogKey(e) {
                if (togMode !== 'keyboard') return;
                const num = parseInt(e.key);
                if (num >= 1 && num <= 9 && num === togTargets[togTargetIndex]) {
                    togTargetIndex++;
                    if (togTargetIndex >= togTargets.length) {
                        document.removeEventListener('keydown', handleTogKey);
                        endTogTest();
                    } else {
                        highlightTogTarget();
                    }
                }
            }

            function endTogTest() {
                const elapsed = ((performance.now() - togStartTime) / 1000).toFixed(2);

                if (togMode === 'mouse') {
                    togMouseTime = elapsed;
                    document.getElementById('tog-mouse-time').textContent = elapsed + 's';
                    document.getElementById('tog-mouse-feel').textContent = 'Slow?';
                } else {
                    togKeyboardTime = elapsed;
                    document.getElementById('tog-keyboard-time').textContent = elapsed + 's';
                    document.getElementById('tog-keyboard-feel').textContent = 'Fast?';
                }

                togMode = null;
                updateTogResult();
            }

            function updateTogResult() {
                if (togMouseTime && togKeyboardTime) {
                    const result = document.getElementById('tog-result');
                    const mouseFaster = parseFloat(togMouseTime) < parseFloat(togKeyboardTime);

                    if (mouseFaster) {
                        result.innerHTML = `<span style="color: #22c55e;">PARADOX CONFIRMED!</span> Mouse was ${(parseFloat(togKeyboardTime) - parseFloat(togMouseTime)).toFixed(2)}s faster, but keyboard probably FELT faster!`;
                    } else {
                        result.innerHTML = `Keyboard was faster this time. Try again - the paradox often appears with complex menu navigation.`;
                    }
                }
            }

            function resetTogTest() {
                togMode = null;
                togMouseTime = null;
                togKeyboardTime = null;
                document.getElementById('tog-arena').innerHTML = '';
                document.getElementById('tog-mouse-time').textContent = '-';
                document.getElementById('tog-keyboard-time').textContent = '-';
                document.getElementById('tog-mouse-feel').textContent = '-';
                document.getElementById('tog-keyboard-feel').textContent = '-';
                document.getElementById('tog-result').textContent = 'Run both tests to compare!';
            }

            // Solow Paradox Chart
            function drawSolowChart() {
                const canvas = document.getElementById('solow-canvas');
                const ctx = canvas.getContext('2d');
                const w = canvas.width;
                const h = canvas.height;

                ctx.fillStyle = '#0f172a';
                ctx.fillRect(0, 0, w, h);

                // Draw axes
                ctx.strokeStyle = '#64748b';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(50, 20);
                ctx.lineTo(50, h - 30);
                ctx.lineTo(w - 20, h - 30);
                ctx.stroke();

                // Labels
                ctx.fillStyle = '#94a3b8';
                ctx.font = '12px sans-serif';
                ctx.fillText('1980', 50, h - 10);
                ctx.fillText('2000', w/2, h - 10);
                ctx.fillText('2020', w - 50, h - 10);

                // IT Investment (exponential growth)
                const itData = [];
                for (let i = 0; i <= 40; i++) {
                    itData.push(Math.pow(1.08, i) / Math.pow(1.08, 40) * (h - 80));
                }

                // Productivity (slow linear growth)
                const prodData = [];
                for (let i = 0; i <= 40; i++) {
                    prodData.push((1 + i * 0.0125) / 1.5 * (h - 80) * 0.3);
                }

                // Animate
                let frame = 0;
                function animate() {
                    if (frame > 40) return;

                    // Draw IT spending
                    ctx.strokeStyle = '#6366f1';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(50, h - 30 - itData[0]);
                    for (let i = 1; i <= frame; i++) {
                        const x = 50 + (i / 40) * (w - 70);
                        ctx.lineTo(x, h - 30 - itData[i]);
                    }
                    ctx.stroke();

                    // Draw Productivity
                    ctx.strokeStyle = '#f59e0b';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(50, h - 30 - prodData[0]);
                    for (let i = 1; i <= frame; i++) {
                        const x = 50 + (i / 40) * (w - 70);
                        ctx.lineTo(x, h - 30 - prodData[i]);
                    }
                    ctx.stroke();

                    // Legend
                    ctx.fillStyle = '#6366f1';
                    ctx.fillRect(w - 150, 30, 20, 10);
                    ctx.fillStyle = '#e2e8f0';
                    ctx.fillText('IT Spending', w - 125, 40);

                    ctx.fillStyle = '#f59e0b';
                    ctx.fillRect(w - 150, 50, 20, 10);
                    ctx.fillStyle = '#e2e8f0';
                    ctx.fillText('Productivity', w - 125, 60);

                    frame++;
                    requestAnimationFrame(animate);
                }
                animate();
            }

            // Market Efficiency Simulator
            function simulateMarket() {
                const analysts = parseFloat(document.getElementById('market-analysts').value);
                document.getElementById('market-analysts-val').textContent = analysts + '%';

                const canvas = document.getElementById('market-canvas');
                const ctx = canvas.getContext('2d');
                const w = canvas.width;
                const h = canvas.height;

                ctx.fillStyle = '#0f172a';
                ctx.fillRect(0, 0, w, h);

                // True value line
                const trueValue = h / 2;
                ctx.strokeStyle = '#22c55e';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(0, trueValue);
                ctx.lineTo(w, trueValue);
                ctx.stroke();
                ctx.setLineDash([]);

                // Market price (more volatile when fewer analysts)
                const volatility = Math.max(5, 80 - analysts * 0.7);
                let price = trueValue;

                ctx.strokeStyle = '#6366f1';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, price);

                for (let x = 1; x < w; x++) {
                    // Random walk with mean reversion (stronger when more analysts)
                    const meanReversion = (trueValue - price) * (analysts / 1000);
                    const noise = (Math.random() - 0.5) * volatility;
                    price += meanReversion + noise;
                    price = Math.max(20, Math.min(h - 20, price));
                    ctx.lineTo(x, price);
                }
                ctx.stroke();

                // Calculate metrics
                const efficiency = Math.min(95, 20 + analysts * 0.75);
                const profit = analysts > 0 ? Math.max(0, (100 - analysts) * 10 - 200) : 0;
                const worthIt = profit > 500 ? 'Yes' : (profit > 0 ? 'Marginal' : 'No');

                document.getElementById('market-efficiency').textContent = efficiency.toFixed(0) + '%';
                document.getElementById('market-profit').textContent = '$' + profit.toFixed(0);
                document.getElementById('market-profit').style.color = profit > 500 ? '#22c55e' : (profit > 0 ? 'var(--accent)' : '#ef4444');
                document.getElementById('market-worth').textContent = worthIt;
                document.getElementById('market-worth').style.color = worthIt === 'Yes' ? '#22c55e' : (worthIt === 'Marginal' ? 'var(--accent)' : '#ef4444');

                document.getElementById('market-explanation').textContent =
                    `With ${analysts}% analysts active, market efficiency is ${efficiency.toFixed(0)}%. ` +
                    (analysts < 30 ? 'Few analysts means big mispricings and profit opportunities!' :
                     analysts > 70 ? 'Many analysts competing - profits disappear, some leave, cycle continues.' :
                     'Equilibrium zone: just enough analysts to keep markets mostly efficient.');
            }

            document.getElementById('market-analysts').addEventListener('input', function() {
                document.getElementById('market-analysts-val').textContent = this.value + '%';
            });

            // Tolerance Paradox Simulator
            function runToleranceSim() {
                const policy = document.getElementById('tolerance-policy').value;
                const timeline = document.getElementById('tolerance-timeline');
                timeline.innerHTML = '';

                let tolerance = 90;
                let intolerant = 5;
                const history = [];

                for (let year = 0; year < 50; year++) {
                    // Intolerant grow if tolerated
                    if (policy === 'unlimited') {
                        intolerant = Math.min(95, intolerant * 1.08);
                        tolerance = Math.max(5, 100 - intolerant);
                    } else if (policy === 'paradox') {
                        // Suppress intolerance when it exceeds threshold
                        if (intolerant > 15) {
                            intolerant = Math.max(5, intolerant * 0.95);
                        } else {
                            intolerant = Math.min(15, intolerant * 1.02);
                        }
                        tolerance = Math.max(70, 100 - intolerant);
                    } else {
                        // Low tolerance suppresses everyone
                        intolerant = Math.max(2, intolerant * 0.9);
                        tolerance = Math.max(30, 40 + Math.random() * 10);
                    }

                    history.push({ tolerance, intolerant });
                }

                // Draw timeline
                history.forEach((h, i) => {
                    const bar = document.createElement('div');
                    bar.style.cssText = `
                        flex: 1;
                        background: linear-gradient(to top,
                            #ef4444 ${h.intolerant}%,
                            #22c55e ${h.intolerant}%,
                            #22c55e ${h.tolerance}%,
                            var(--muted) ${h.tolerance}%);
                        border-radius: 2px;
                    `;
                    bar.title = `Year ${i + 1}: Tolerance ${h.tolerance.toFixed(0)}%, Intolerant ${h.intolerant.toFixed(0)}%`;
                    timeline.appendChild(bar);
                });

                const final = history[history.length - 1];
                document.getElementById('tolerance-final').textContent = final.tolerance.toFixed(0) + '%';
                document.getElementById('tolerance-final').style.color = final.tolerance > 60 ? '#22c55e' : '#ef4444';
                document.getElementById('tolerance-intolerant').textContent = final.intolerant.toFixed(0) + '%';

                const resultEl = document.getElementById('tolerance-result');
                if (policy === 'unlimited') {
                    resultEl.innerHTML = '<span style="color: #ef4444;">Unlimited tolerance leads to its own destruction.</span> Intolerance grows unchecked.';
                } else if (policy === 'paradox') {
                    resultEl.innerHTML = '<span style="color: #22c55e;">Popper\'s approach works!</span> Tolerance survives by not tolerating intolerance.';
                } else {
                    resultEl.innerHTML = '<span style="color: var(--accent);">Low tolerance maintains order but limits freedom.</span> Everyone is suppressed.';
                }
            }

            // Initialize new simulators
            window.addEventListener('load', () => {
                drawSolowChart();
                simulateMarket();
                runToleranceSim();
            });
        </script>
    </main>
</body>
</html>
